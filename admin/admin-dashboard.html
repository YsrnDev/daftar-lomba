<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin</title>
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="admin-style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="admin-container">
      <h2>Dashboard Admin Lomba</h2>
      <div id="loader" class="loader">Memuat data...</div>
      <div id="dashboard-content" style="display: none">
        <div class="dashboard-card">
          <h3>Total Pendaftar</h3>
          <p id="total-pendaftar">0</p>
        </div>

        <div class="dashboard-card">
          <h3>Pendaftar per Lomba</h3>
          <canvas id="lombaChart"></canvas>
        </div>

        <div class="dashboard-card">
          <h3>Pendaftar per Usia</h3>
          <canvas id="usiaChart"></canvas>
        </div>

        <a href="admin-report.html" class="btn">Lihat Laporan & Cetak PDF</a>
      </div>
    </div>

    <script>
      if (!localStorage.getItem("loggedIn")) {
        window.location.href = "admin-login.html";
      }

      const ADMIN_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxqC9qYq4aVAPTOJT5NuI8D_m8sfAfYh0AGHBpPyG8bjldhUT2FTQAzy7PlEayaWkCJLg/exec"; // <-- Akan diisi nanti
      const loader = document.getElementById("loader");
      const content = document.getElementById("dashboard-content");

      async function fetchData() {
        try {
          const response = await fetch(`${ADMIN_SCRIPT_URL}?action=getData`);
          const data = await response.json();

          document.getElementById("total-pendaftar").textContent =
            data.totalPendaftar;

          new Chart(document.getElementById("lombaChart").getContext("2d"), {
            type: "bar",
            data: {
              labels: Object.keys(data.lombaData),
              datasets: [
                {
                  label: "Jumlah Pendaftar",
                  data: Object.values(data.lombaData),
                  backgroundColor: [
                    "#e74c3c",
                    "#3498db",
                    "#2ecc71",
                    "#9b59b6",
                    "#f1c40f",
                  ],
                },
              ],
            },
          });

          new Chart(document.getElementById("usiaChart").getContext("2d"), {
            type: "pie",
            data: {
              labels: Object.keys(data.usiaData),
              datasets: [
                {
                  data: Object.values(data.usiaData),
                  backgroundColor: [
                    "#fd79a8",
                    "#a29bfe",
                    "#ffeaa7",
                    "#00cec9",
                    "#55efc4",
                  ],
                },
              ],
            },
          });

          loader.style.display = "none";
          content.style.display = "block";
        } catch (error) {
          console.error("Error fetching data:", error);
          loader.textContent = "Gagal memuat data.";
        }
      }
      fetchData();
    </script>
  </body>
</html>
